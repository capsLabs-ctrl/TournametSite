<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/css/registration.css">
    <link rel="stylesheet" href="../static/css/index.css">
    <title>Главная страница</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg" href="../static/images/iconYellow.svg">
    
</head>
<body>
    <header class="header">
        <ul class="no-style-ul nav-ul">
            <li class="header-links"><a href="#first-line" class="no-style-a">О турнире</a></li>
            <li class="header-links"><a href="#second-line" class="no-style-a">Правила</a></li>
            <li class="header-links"><a href="/grids" class="no-style-a">Сетка</a></li>
            <li class="header-links hover-cursor-pointer" onclick="showAdd()">Добавить игру</li>
        </ul>
        <p class="header-links registrarion-link hover-cursor-pointer" onclick="showRegistration()">Регистрация</p>
    </header>
    <main>
        <section id="firstBG" class="section">
            <div class="first-page-content">
                <p class="welcome-text">Турнир по Dota 2 "1000-7?"</p>
                <p class="end-text">Готовьтесь к невероятным битвам один на один! Турнир "1000-7?" приглашает всех любителей Dota 2 проявить свои навыки и сразиться за звание лучшего соло-игрока.</p>
            </div>
        </section>
        <div class="line" id="first-line"></div>
        <section id="secondBG" class="fit-section dota-label-bg">
            <div class="info-page-content">
                <h3 class="align-self-center pt20" style="margin-top: 20px;">Дата проведения</h3>
                <p style="margin-top: 40px;">Турнир стартует [указать точную дату] и продлится несколько дней (в зависимости от количества участников).</p>
                <h3 class="align-self-center pt20" style="margin-top: 40px;">Формат турнира</h3>
                <ul class="no-style-ul">
                    <li class="first-level-li" style="margin-top: 40px;"><h3>Режим:</h3>
                        <p class="second-level-li list-container">Игра проходит в формате 1 на 1, до двух смертей или сноса T1 вышки.</p>
                    </li>
                    <li class="first-level-li"><h3>Груповая стадия:</h3>
                        <ul class="list-container" style="list-style: disc;">
                            <li class="second-level-li">Участники будут разделены на 4 группы (количество групп может быть изменено в зависимости от числа участников).</li>
                            <li class="second-level-li">Из каждой группы определённое количество игроков (в зависимости от общей численности) выйдет в следующую стадию.</li>
                        </ul></li>
                        <li class="first-level-li"><h3>Плей-офф:</h3>
                            <ul class="list-container" style="list-style: disc;">
                                <li class="second-level-li">Турнирная сетка с верхней и нижней частью.</li>
                            <li class="second-level-li">После групповой стадии победители займут места в верхней сетке, а проигравшие получат второй шанс в нижней.</li>
                            <li class="second-level-li">Матчи на выбывание до финала, где определится абсолютный чемпион!</li>
                        </ul></li>
                    <li class="first-level-li"><h3>Особенности:</h3>
                        <ul class="list-container" style="list-style: disc;">
                            <li class="second-level-li">Турнир открыт для всех желающих, вне зависимости от рейтинга.</li>
                            <li class="second-level-li">Призы для лучших игроков (детали о призовом фонде будут анонсированы ближе к дате проведения).</li>
                        </ul></li>
                    </li>
                </ul>
                <h3 class="align-self-center pt20" style="margin-top: 40px;">Как принять участие</h3>
                <p class="second-level-li" style="margin-top: 40px;">Заявки на участие принимаются до [указать дату окончания регистрации]. Для регистрации свяжитесь с организаторами или заполните форму по ссылке. Не упустите шанс продемонстрировать своё мастерство и доказать, что вы достойны победить в "1000-7?"! Стань легендой соло-режима!</p>
            </div>
        </section>
        <div class="line" id="second-line"></div>
        <section id="thirdBG" class="fit-section">
            <div class="info-page-content">
                <h3 class="align-self-center pt20" style="margin-top: 20px;">Правила турнира "1000-7?"</h3>
                <h3 style="margin-top: 20px;">Основные правила матча:</h3>
                <ol class="list-container">
                    <li class="second-level-li li-marker"><h3>Формат игры:</h3>
                        <ol class="list-container">
                            <li class="third-level-li">Каждый матч проводится в режиме 1 на 1.</li>
                            <li class="third-level-li">Победа засчитывается при выполнении одного из условий:
                                <ul class="list-container" style="list-style: disc;">
                                    <li class="fourth-level-li">Первый игрок делает два убийства.</li>
                                    <li class="fourth-level-li">Один из игроков уничтожает T1 вышку противника.</li>
                                </ul>
                            </li>
                        </ol>
                    </li>
                    <li class="second-level-li li-marker" style="margin-top: 20px;"><h3>Запрещённые предметы:</h3>
                        <div class="first-level-li image-and-text"><img class="image" src="../static/images/grenage.png" alt="Изображение гранаты"> <p>Blood Grenade</p></div>
                        <div class="first-level-li image-and-text"><img class="image" src="../static/images/raindrop.png" alt="Изображение раиндропов"> <p>Infused Raindrop</p></div>
                    </li>
                    <li class="second-level-li li-marker" style="margin-top: 20px;"><h3>Баны героев:</h3>
                        <ol class="list-container">
                            <li class="third-level-li"> Каждый игрок может забанить двух героев перед началом матча.</li>
                            <li class="third-level-li"> Процедура банов проходит перед началом игры, в чате лобби.</li>
                        </ol>
                    </li>
                </ol>
            </div>
        </section>
        <div class="line" id="third-line"></div>
        <section id="fourthBG" class="fit-section dota-label-bg">
            <div class="info-page-content">
                <h3 class="pt20 align-self-center" style="margin-top: 20px;">Порядок проведения матчей</h3>
                <ol class="list-container" style="margin-top: 10px;">
                    <li class="second-level-li li-marker" style="margin-top: 30px;"><h3>Лобби:</h3>
                        <ol class="list-container">
                            <li class="third-level-li">Лобби создаётся с включёнными читами для ускорения начала игры.</li>
                            <li class="third-level-li">После загрузки оба игрока пишут -teleport и перемещаются в центр карты.</li>
                            <li class="third-level-li">Начало игры ускоряется командой -startgame, вводимой организатором или игроками после подтверждения готовности обоих игроков.</li>
                        </ol>
                    </li>
                    <li class="second-level-li li-marker" style="margin-top: 20px;"><h3>Руны:</h3>
                        <p class="third-level-li list-container">Подбор любых рун (богатства, иллюзий, DD, регенерации и т.д.) запрещён</p>
                    </li>
                    <li class="second-level-li li-marker" style="margin-top: 20px;"><h3>Лес:</h3>
                        <p class="third-level-li list-container">Фарм нейтральных крипов, а так же отводы запрещены.</p>
                    </li>
                    <li class="second-level-li li-marker" style="margin-top: 20px;"><h3>Честность игры:</h3>
                        <ol class="list-container">
                            <li class="third-level-li">Оба игрока обязаны подтвердить готовность и соблюдать правила.</li>
                            <li class="third-level-li">Все действия, нарушающие честную игру, будут наказываться вплоть до дисквалификации.</li>
                        </ol>
                    </li>
                </ol>
                <h3 class="pt20 align-self-center" style="margin-top: 40px;">Дополнительные условия</h3>
                <ul class="no-style-ul list-container" style="margin-top: 30px;">
                    <li class="li-marker"><h3>Паузы:</h3>
                        <p class="third-level-li list-container">Если у игрока возникают технические проблемы, он может поставить паузу. Максимальное время паузы — 5 минут, по согласованию с судьёй.</p>
                    </li>
                </ul>
                <h3 class="pt20 align-self-center" style="margin-top: 40px;">Дисквалификация</h3>
                <p style="margin-top: 40px;">Игрок может быть дисквалифицирован за:</p>
                <ul>
                    <li class="third-level-li list-container">Нарушение указанных правил (например, использование запрещённых предметов или подбор рун).</li>
                    <li class="third-level-li">Использование сторонних программ или игровых багов.</li>
                </ul>
                <h3 class="pt20 align-self-center" style="margin-top: 40px;">Решение спорных ситуаций</h3>
                <p style="margin-top: 40px;">В случае спорных моментов решение принимает судейская команда. Их решение является окончательным и не подлежит обжалованию.</p>
            </div>
        </section>
    </main>
    <footer>
        <p>По вопросам обращаться <a class="no-style-a a-text-color" href="https://t.me/capsLabss">сюда</a></p>
    </footer>
    <section id="regItem">
        <section class="registratin-section">
            <p class="material-symbols-outlined hover-cursor-pointer" id="closeicon" onclick="hideRegistration()">close</p>
                <section>
                    <h1 style="margin-top: 30px; padding: 0px 80px; font-size: 20pt; text-align: center;">Отправьте заявку на участие в турние</h1>
                </section>
                <label class="reg_item" style="margin-top: 60px;">Имя<input class="label-input" name="nameInput" placeholder="Ник длинной до 10ти символов" class="main_section_items" type="text" required></label>
                <label class="reg_item">Телеграм аккаунт<input class="label-input" name="tgInput" class="main_section_items" type="text" required></label>
                <label class="reg_item">Цифры стим аккаунта<input class="label-input" name="steamInput" class="main_section_items" type="text" required></label>
                <p id="error-message" class="hide-error">1</p>
                <button type="button" class="main_section_items button" onclick="buttonClick()">Отправить</button>
                <section id="animunit">
                    <span class="material-symbols-outlined reg_item" style="margin-top: 25px;" id="icon">
                        <!-- autorenew -->
                        <!-- check -->
                        <!-- close -->
                        </span>
                </section>
        </section>
    </section>
    <section id="addGameItem">
        <form>
            <div class="add-section">
                <div class="icon-container">
                    <p class="material-symbols-outlined hover-cursor-pointer" id="closeicon" onclick="hideAdd()">close</p>
                </div>
                <h4 class="header-text">Добавление игры в базу данных</h4>
                <label class="reg_item"><p>Пароль</p><input class="label-input" id="password" type="password"></label>
                <label class="reg_item hidden hide"><p>idМатча</p><input class="label-input" id="matchID" type="text"></label>
                <label class="reg_item hidden hide player"><p>Игрок 1</p><input list="players" class="label-input" id="player1Name" type="text"></label>
                <label class="reg_item hidden hide player"><p>Игрок 2</p><input list="players" class="label-input" id="player2Name" type="text"></label>
                <label class="reg_item hidden hide"><p>Победитель</p><input list="winners" class="label-input" id="winner" type="text"></label>
                <label class="reg_item hidden hide"><p>Груповая стадия?</p><input class="label-input" id="group" type="checkbox"></label>
                <button type="button" class="main_section_items button" onclick="buttonCheckClick()">Отправить</button>
                <datalist id ="players">
                </datalist>
                <datalist id ="winners">
                </datalist>
            </div>
        </form>
    </section>
    <script src="../static/js/registration.js">
    </script>
    <script>
        let prr = false;
        let players = [];
        fetchAndDisplayPlayers();
        function buttonCheckClick(){
            console.log(players);
            if(prr !== true)
            hashString(document.querySelector("#password").value).then(hash => {prr = hash === "de34d10f09c2800918c27c04b3936ab25ce958de6021b846226e8c78f43207f4"? true:false;
                if(prr === true){
                    document.querySelectorAll(".hide").forEach(element => {element.classList.remove("hidden")});
                    fetchAndDisplayPlayers();
                }
            })
            else{
                addGameToDB();
            }
        }
        async function getPlayersFromBD(){
        try {
            const dataToSend = {};
            const response = await fetch('https://tournametsite.onrender.com/get_players', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json' 
                },  
                body: JSON.stringify(dataToSend)
            });
            const data = await response.json();
            players = data["players"];
        }
        catch (error) {
            console.error('Ошибка:', error);
        }
    }
        async function fetchAndDisplayPlayers() {
            await getPlayersFromBD();
            fillDataList(players);
}
        document.querySelectorAll(".player").forEach(playerin=>{playerin.addEventListener("change", () => {
            if(players.includes(document.querySelector("#player1Name").value) && players.includes(document.querySelector("#player2Name").value)){
                let player1 = document.querySelector("#player1Name").value;
                let player2 = document.querySelector("#player2Name").value;
                let winners = document.querySelector("#winners");
                winners.innerHTML = "";
                let player1o = document.createElement("option");
                let player2o = document.createElement("option");
                player1o.innerText = player1;
                player1o.value = player1;
                player2o.innerText = player2;
                player2o.value = player2;
                winners.appendChild(player1o);
                winners.appendChild(player2o);
            }
            })});
        async function addGameToDB(){
            let matchId = document.querySelector("#matchID").value;
            let player1 = document.querySelector("#player1Name").value;
            let player2 = document.querySelector("#player2Name").value;
            let winner = document.querySelector("#winner").value;
            let group = document.querySelector("#group").checked;
            if(matchId != "" && players.includes(player1) && players.includes(player2) && (winner === player1 || winner===player2)){
                try {
                    const dataToSend = {
                        'player1': player1,
                        'player2': player2,
                        'winner': winner,
                        'matchID': matchId,
                        'date':(new Date()).toISOString().split('T')[0],
                        'group': group,
                    };
                    const response = await fetch('https://tournametsite.onrender.com/add_match', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json' 
                        },  
                        body: JSON.stringify(dataToSend)
                    });
                    const data = await response.json();
                    if (!data["executed"]){
                        alert("Ошибка при добавлении в базу данных");
                    }
                    else{
                        alert("Матч успешно добавлен!");
                    }
                }
                catch (error) {
                    console.error('Ошибка:', error);
                }
            }
            else alert("Выбери игрока из списка");
        }
        function fillDataList(players){
            let datalist = document.querySelector("#players");
            datalist.innerHTML = "";
            players.forEach(player => {
                let playerOption = document.createElement("option");
                playerOption.value = player;
                playerOption.innerText = player;
                datalist.appendChild(playerOption);
            });
        }
        function showAdd(){
            document.querySelector("#addGameItem").style.display = "flex";
            document.querySelector("body").classList.add("no-sctoll");
        }
        function hideAdd(){
            document.querySelector("body").classList.remove("no-sctoll");
            document.querySelector("#addGameItem").style.display = "none";
            document.querySelectorAll(".hide").forEach(element =>{element.classList.add("hidden");})
            document.querySelector("#matchID").value = "";
            document.querySelector("#password").value = "";
            document.querySelector("#player1Name").value = "";
            document.querySelector("#player2Name").value = "";
            prr = false;
        }
        async function hashString(message) {
            const encoder = new TextEncoder();
            const data = encoder.encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        } 
    </script>  
</body>
</html>